\hypertarget{_cool_file_system_8cpp_source}{}\section{Cool\+File\+System.\+cpp}

\begin{DoxyCode}
00001 
00010 \textcolor{preprocessor}{#include "FS.h"}                \textcolor{comment}{// File Storage System >>>
       http://esp8266.github.io/Arduino/versions/2.0.0/doc/filesystem.html}
00011 \textcolor{preprocessor}{#include"\hyperlink{_cool_file_system_8h}{CoolFileSystem.h}"}
00012 \textcolor{preprocessor}{#include "ArduinoJson.h"}      \textcolor{comment}{// Arduino JSON File controller  https://github.com/bblanchon/ArduinoJson}
00013 
\Hypertarget{_cool_file_system_8cpp_source_l00022}\hyperlink{class_cool_file_system_a6ba6f666ed4c530174f8569d2c636748}{00022} \textcolor{keywordtype}{bool} \hyperlink{class_cool_file_system_a6ba6f666ed4c530174f8569d2c636748}{CoolFileSystem::begin}()
00023 \{
00024     \textcolor{keywordflow}{return}( SPIFFS.begin() );                                   \textcolor{comment}{//Initialize Filesystem}
00025 
00026 \}
00027 
\Hypertarget{_cool_file_system_8cpp_source_l00038}\hyperlink{class_cool_file_system_a4c560c2ddd40b74b7758e6ceb2c58957}{00038} \textcolor{keywordtype}{bool} \hyperlink{class_cool_file_system_a4c560c2ddd40b74b7758e6ceb2c58957}{CoolFileSystem::saveSensorData}(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* data,\textcolor{keywordtype}{int} Sensor\_JSON\_SIZE)
00039 \{
00040     File sensorsData=SPIFFS.open(\textcolor{stringliteral}{"/sensorsData.json"},\textcolor{stringliteral}{"a+"});
00041     \textcolor{keywordflow}{if}(!sensorsData)
00042     \{
00043         this->savedData=\textcolor{keyword}{false};
00044         \textcolor{keywordflow}{return} (\textcolor{keyword}{false}); 
00045     \}   
00046 
00047     DynamicJsonBuffer jsonBuffer(Sensor\_JSON\_SIZE);
00048     JsonObject& root = jsonBuffer.parseObject(data);
00049     
00050     root.printTo(sensorsData);
00051     sensorsData.close();
00052     
00053     this->savedData=\textcolor{keyword}{true};
00054     \textcolor{keywordflow}{return} (\textcolor{keyword}{true});      
00055 \}
00056 
\Hypertarget{_cool_file_system_8cpp_source_l00065}\hyperlink{class_cool_file_system_a32dad79ae80182a83e2e8f52286b7c7b}{00065} \textcolor{keywordtype}{bool} \hyperlink{class_cool_file_system_a32dad79ae80182a83e2e8f52286b7c7b}{CoolFileSystem::updateConfigFiles}(String answer,\textcolor{keywordtype}{int} JSON\_SIZE)
00066 \{
00067     \textcolor{comment}{//String conversion to char*}
00068 
00069     \textcolor{keywordtype}{char} *jsonRoot = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[answer.length() + 1];
00070     strcpy(jsonRoot, answer.c\_str());
00071     \textcolor{comment}{//total json object }
00072     DynamicJsonBuffer jsonBuffer(JSON\_SIZE);
00073     JsonObject& root = jsonBuffer.parseObject(jsonRoot);
00074 
00075 
00076         
00077     \textcolor{comment}{//temp string}
00078     String \hyperlink{_irene3000_8h_a5905d48604152cf57aa6bfa087b49173}{temp};
00079 
00080     \textcolor{comment}{//CoolBoard Configuration File}
00081 
00082         JsonObject& jsonCoolBoard=root[\textcolor{stringliteral}{"CoolBoard"}];
00083     \textcolor{keywordflow}{if}(jsonCoolBoard.success())
00084     \{
00085         File coolBoardConfig = SPIFFS.open(\textcolor{stringliteral}{"/coolBoardConfig.json"}, \textcolor{stringliteral}{"w"});   
00086         \textcolor{keywordflow}{if}(!coolBoardConfig)
00087         \{   
00088             Serial.println(\textcolor{stringliteral}{"failed to open coolBoardConfig.json"});
00089             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00090         \}
00091         Serial.println(\textcolor{stringliteral}{"CoolBoard Config"});
00092         jsonCoolBoard.printTo(Serial);
00093         
00094         jsonCoolBoard.printTo(coolBoardConfig);
00095         
00096         coolBoardConfig.close();
00097     \}
00098     \textcolor{keywordflow}{else}
00099     \{
00100         Serial.println(\textcolor{stringliteral}{"failed to pars coolBoard "});
00101     \}       
00102 
00103     
00104     \textcolor{comment}{//Cool Board Sensors Configuration File}
00105     DynamicJsonBuffer jsonSBoard;
00106         JsonObject& jsonSensorsBoard=root[\textcolor{stringliteral}{"CoolSensorsBoard"}];  
00107     \textcolor{keywordflow}{if}(jsonSensorsBoard.success())
00108     \{   
00109         File coolBoardSensorsConfig = SPIFFS.open(\textcolor{stringliteral}{"/coolBoardSensorsConfig.json"}, \textcolor{stringliteral}{"w"}); 
00110         \textcolor{keywordflow}{if}(!coolBoardSensorsConfig)
00111         \{
00112             Serial.println(\textcolor{stringliteral}{"failed to open coolBoardSensors.json"});
00113             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00114         \}
00115         
00116         Serial.println(\textcolor{stringliteral}{"CoolBoardSensors Config"});
00117         jsonSensorsBoard.printTo(coolBoardSensorsConfig);
00118         jsonSensorsBoard.printTo(Serial);
00119         coolBoardSensorsConfig.close();
00120     \}
00121     \textcolor{keywordflow}{else}
00122     \{
00123         Serial.println(\textcolor{stringliteral}{"failed to parse on board sensors "});    
00124     \}
00125     
00126     
00127     
00128     \textcolor{comment}{//rtc configuration file}
00129     DynamicJsonBuffer jsonR;
00130         JsonObject& jsonRTC=root[\textcolor{stringliteral}{"rtc"}];
00131     Serial.println(\textcolor{stringliteral}{"before config rtc json"});
00132     jsonRTC.printTo(Serial);
00133     \textcolor{keywordflow}{if}(jsonRTC.success() )
00134     \{
00135         File rtcConfig = SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"w"});   
00136         \textcolor{keywordflow}{if}(!rtcConfig)
00137         \{
00138             Serial.println(\textcolor{stringliteral}{"failed to open rtcConfig.json"});
00139             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00140         \}
00141         Serial.println(\textcolor{stringliteral}{"RTC Config"});
00142         jsonRTC.printTo(rtcConfig);
00143         jsonRTC.printTo(Serial);
00144         rtcConfig.close();
00145     
00146     \}
00147     \textcolor{keywordflow}{else}
00148     \{
00149         Serial.println(\textcolor{stringliteral}{"failed to parse rtc "});
00150     \}
00151 
00152     
00153     
00154     
00155     
00156         \textcolor{comment}{//cool board led configuration}
00157     DynamicJsonBuffer jsonLBoard;
00158         JsonObject& jsonLedBoard=root[\textcolor{stringliteral}{"led"}];
00159     Serial.println(\textcolor{stringliteral}{"before config Led json"});
00160     jsonLedBoard.printTo(Serial);
00161     \textcolor{keywordflow}{if}(jsonLedBoard.success())
00162     \{   
00163         File coolBoardLedConfig = SPIFFS.open(\textcolor{stringliteral}{"/coolBoardLedConfig.json"}, \textcolor{stringliteral}{"w"}); 
00164         \textcolor{keywordflow}{if}(!coolBoardLedConfig)
00165         \{
00166             Serial.println(\textcolor{stringliteral}{"failed to open led config"});
00167             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00168         \}
00169         Serial.println(\textcolor{stringliteral}{"CoolBoardLed Config"});
00170         jsonLedBoard.printTo(coolBoardLedConfig);
00171         jsonLedBoard.printTo(Serial);
00172         coolBoardLedConfig.close();
00173     
00174     \}
00175     \textcolor{keywordflow}{else}
00176     \{
00177         Serial.println(\textcolor{stringliteral}{"failed to parse led"});
00178     \}
00179         
00180 
00181     
00182 
00183     \textcolor{comment}{//jetpack configuration}
00184     DynamicJsonBuffer jsonJBoard;
00185         JsonObject& jsonJetpack=root[\textcolor{stringliteral}{"jetPack"}];
00186     Serial.println(\textcolor{stringliteral}{"before config jetpack json"});
00187     jsonJetpack.printTo(Serial);
00188     \textcolor{keywordflow}{if}(jsonJetpack.success())
00189     \{   
00190         File jetPackConfig = SPIFFS.open(\textcolor{stringliteral}{"/jetPackConfig.json"}, \textcolor{stringliteral}{"w"});   
00191         \textcolor{keywordflow}{if}(!jetPackConfig)
00192         \{
00193             Serial.println(\textcolor{stringliteral}{"failed to open jetpack file"});
00194             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00195         \}
00196         Serial.println(\textcolor{stringliteral}{"jetpack Config"});   
00197         jsonJetpack.printTo(jetPackConfig);
00198         jsonJetpack.printTo(Serial);
00199         jetPackConfig.close();
00200     \}
00201     \textcolor{keywordflow}{else}
00202     \{
00203         Serial.println(\textcolor{stringliteral}{"failed to parse jetpack"});  
00204     \}
00205     
00206     \textcolor{comment}{//irene configuration   }
00207     DynamicJsonBuffer jsonIBoard;
00208         JsonObject& jsonIrene=root[\textcolor{stringliteral}{"irene3000"}];
00209     Serial.println(\textcolor{stringliteral}{"before config irene json"}); 
00210     jsonIrene.printTo(Serial);
00211     \textcolor{keywordflow}{if}(jsonIrene.success())
00212     \{
00213         File irene3000Config = SPIFFS.open(\textcolor{stringliteral}{"/irene3000Config.json"}, \textcolor{stringliteral}{"w"});   
00214         \textcolor{keywordflow}{if}(!irene3000Config)
00215         \{
00216             Serial.println(\textcolor{stringliteral}{"failed to open irene file"});
00217             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00218         \}
00219         Serial.println(\textcolor{stringliteral}{"irene3000 Config"});
00220         jsonIrene.printTo(irene3000Config);
00221         jsonIrene.printTo(Serial);
00222         irene3000Config.close();
00223     
00224     \}
00225     \textcolor{keywordflow}{else}
00226     \{
00227         Serial.println(\textcolor{stringliteral}{"failed to parse irene"});    
00228     \}
00229     
00230     \textcolor{comment}{//external sensors}
00231     DynamicJsonBuffer jsonESBoard;
00232         JsonObject& jsonExternalSensors=root[\textcolor{stringliteral}{"externalSensors"}];
00233     Serial.println(\textcolor{stringliteral}{"before config external Sensors json"});
00234     jsonExternalSensors.printTo(Serial);
00235     \textcolor{keywordflow}{if}(jsonExternalSensors.success())
00236     \{
00237         File externalSensorsConfig = SPIFFS.open(\textcolor{stringliteral}{"/externalSensorsConfig.json"}, \textcolor{stringliteral}{"w"});   
00238         \textcolor{keywordflow}{if}(!externalSensorsConfig)
00239         \{
00240             Serial.println(\textcolor{stringliteral}{"failed to open external sensors file "});
00241             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00242         \}
00243         Serial.println(\textcolor{stringliteral}{"externalSensors Config"});
00244         jsonExternalSensors.printTo(externalSensorsConfig);
00245         jsonExternalSensors.printTo(Serial);
00246     
00247         externalSensorsConfig.close();
00248 
00249     \}
00250     \textcolor{keywordflow}{else}
00251     \{
00252         Serial.println(\textcolor{stringliteral}{"failed to parse external sensors"}); 
00253     \}
00254 
00255     
00256     \textcolor{comment}{//mqtt config}
00257     DynamicJsonBuffer jsonMQ;
00258         JsonObject& jsonMQTT=root[\textcolor{stringliteral}{"mqtt"}];
00259     Serial.println(\textcolor{stringliteral}{"before config mqtt json"});
00260     jsonMQTT.printTo(Serial);
00261     \textcolor{keywordflow}{if}(jsonMQTT.success())
00262     \{
00263         File mqttConfig = SPIFFS.open(\textcolor{stringliteral}{"/mqttConfig.json"}, \textcolor{stringliteral}{"w"}); 
00264         \textcolor{keywordflow}{if}(!mqttConfig)
00265         \{
00266             Serial.println(\textcolor{stringliteral}{"failed to open mqtt file "});        
00267             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
00268         \}
00269         Serial.println(\textcolor{stringliteral}{"mqtt config"});
00270         jsonMQTT.printTo(mqttConfig);
00271         jsonMQTT.printTo(Serial);
00272         mqttConfig.close();
00273     \}
00274     \textcolor{keywordflow}{else}
00275     \{
00276         Serial.println(\textcolor{stringliteral}{"failed to parse mqtt"}); 
00277     \}   
00278         
00279     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00280 
00281 \}   
00282 
\Hypertarget{_cool_file_system_8cpp_source_l00292}\hyperlink{class_cool_file_system_a5a7eaeea7a9fbf8aaef651d862fa3b5b}{00292} \textcolor{keywordtype}{bool} \hyperlink{class_cool_file_system_a5a7eaeea7a9fbf8aaef651d862fa3b5b}{CoolFileSystem::isDataSaved}()
00293 \{
00294     \textcolor{keywordflow}{return}( this->savedData );
00295 \}
00296 
\Hypertarget{_cool_file_system_8cpp_source_l00305}\hyperlink{class_cool_file_system_a5c58bca3735c0ed3efb268d70ef998ef}{00305} String \hyperlink{class_cool_file_system_a5c58bca3735c0ed3efb268d70ef998ef}{CoolFileSystem::getSensorSavedData}()
00306 \{
00307     \textcolor{comment}{//open sensors data file}
00308     File sensorsData=SPIFFS.open(\textcolor{stringliteral}{"/sensorsData.json"},\textcolor{stringliteral}{"r"});
00309     
00310     \textcolor{keywordflow}{if} (!sensorsData)
00311 
00312     \{
00313         \textcolor{keywordflow}{return}(\textcolor{stringliteral}{"failed to open file"});
00314     \}
00315     \textcolor{keywordflow}{else}
00316     \{
00317         \textcolor{keywordtype}{size\_t} size = sensorsData.size();
00318 
00319         \textcolor{comment}{// Allocate a buffer to store contents of the file.}
00320         std::unique\_ptr < char[] > buf(\textcolor{keyword}{new} \textcolor{keywordtype}{char}[size]);
00321 
00322         sensorsData.readBytes(buf.get(), size);
00323 
00324         DynamicJsonBuffer jsonBuffer;
00325 
00326         JsonObject & json = jsonBuffer.parseObject(buf.get());
00327         
00328         \textcolor{keywordflow}{if} (!json.success())
00329         \{
00330             \textcolor{keywordflow}{return}(\textcolor{stringliteral}{"failed to parse json"});
00331         \}
00332         \textcolor{keywordflow}{else}
00333         \{   
00334             \textcolor{comment}{//the return string}
00335             String sensorDataString;
00336             
00337             \textcolor{comment}{//print the json to the string}
00338             json.printTo(sensorDataString);
00339             
00340             \textcolor{comment}{//close the file}
00341             sensorsData.close();
00342 
00343             \textcolor{comment}{//delete data in the file}
00344             File sensorsData=SPIFFS.open(\textcolor{stringliteral}{"/sensorsData.json"},\textcolor{stringliteral}{"w"});
00345             \textcolor{keywordflow}{if} (!sensorsData)   
00346             \{
00347                 \textcolor{keywordflow}{return}(\textcolor{stringliteral}{"failed to delete data in the file"});
00348             \}
00349 
00350             sensorsData.close();
00351             
00352             \textcolor{comment}{//position the saved data flag to false}
00353             this->savedData=\textcolor{keyword}{false};          
00354 
00355             \textcolor{comment}{//return the string}
00356             \textcolor{keywordflow}{return}(sensorDataString);       
00357         \}
00358         
00359         
00360     \}
00361 
00362 \}
00363 
\end{DoxyCode}
