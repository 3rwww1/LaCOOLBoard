\hypertarget{classCoolTime}{}\section{Cool\+Time Class Reference}
\label{classCoolTime}\index{Cool\+Time@{Cool\+Time}}


This class manages the D\+S1337 R\+TC .  




{\ttfamily \#include $<$Cool\+Time.\+h$>$}



Collaboration diagram for Cool\+Time\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=188pt]{classCoolTime__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classCoolTime_ab1976cf718b950bc31e003c3323b8adb}{begin} ()
\item 
void \hyperlink{classCoolTime_aae601f795452cfa48d9fb337aed483a8}{update} ()
\item 
bool \hyperlink{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129}{config} ()
\item 
void \hyperlink{classCoolTime_a014656d0d3f74d6391364b92b13e0780}{config} (I\+P\+Address \hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{time\+Server}, unsigned int \hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{local\+Port})
\item 
void \hyperlink{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1}{print\+Conf} ()
\item 
void \hyperlink{classCoolTime_ab81ea7fdaace111aa01cc1ec84c6d297}{set\+Date\+Time} (int year, int month, int day, int hour, int minutes, int seconds)
\item 
tm\+Elements\+\_\+t \hyperlink{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c}{get\+Time\+Date} ()
\item 
String \hyperlink{classCoolTime_ac4f32ee513c1328d984306645e8785a4}{get\+E\+S\+Date} ()
\item 
unsigned long \hyperlink{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}{get\+Last\+Sync\+Time} ()
\item 
bool \hyperlink{classCoolTime_a5ae038a4498602b189f76a10bf02adf8}{is\+Time\+Sync} (unsigned long seconds=604800)
\item 
time\+\_\+t \hyperlink{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705}{get\+Ntp\+Time} ()
\item 
void \hyperlink{classCoolTime_a236a38d120dc53bc67456d763838c5a1}{send\+N\+T\+Ppacket} (I\+P\+Address \&address)
\item 
String \hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{format\+Digits} (int digits)
\item 
bool \hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{save\+Time\+Sync} ()
\item 
bool \hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{save\+Time\+Sync} ()
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
unsigned long \hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{time\+Sync} =0
\item 
I\+P\+Address \hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{time\+Server}
\item 
Wi\+Fi\+U\+DP \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}
\item 
unsigned int \hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{local\+Port} =0
\item 
byte \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packet\+Buffer} \mbox{[}\hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{N\+T\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}\mbox{]}
\item 
tm\+Elements\+\_\+t \hyperlink{classCoolTime_ad33c2713c903ff064ad09c46406ae088}{tm\+Set}
\item 
D\+S1337\+R\+TC \hyperlink{classCoolTime_abd38f2384ff90692b1568d9db869412e}{rtc}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This class manages the D\+S1337 R\+TC . 

Definition at line 31 of file Cool\+Time.\+h.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classCoolTime_ab1976cf718b950bc31e003c3323b8adb}\label{classCoolTime_ab1976cf718b950bc31e003c3323b8adb}} 
\index{Cool\+Time@{Cool\+Time}!begin@{begin}}
\index{begin@{begin}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{begin()}{begin()}}
{\footnotesize\ttfamily void Cool\+Time\+::begin (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_ab1976cf718b950bc31e003c3323b8adb}{Cool\+Time\+::begin()}\+: This method is provided to init the udp connection 

Definition at line 41 of file Cool\+Time.\+cpp.



References local\+Port, Udp, and update().



Referenced by Cool\+Board\+::begin().


\begin{DoxyCode}
42 \{
43 
44 \textcolor{preprocessor}{#if DEBUG == 1 }
45 
46     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.begin()"});
47     Serial.println();
48 
49 <<<<<<< HEAD
50 \textcolor{preprocessor}{#endif }
51 =======
52 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
53 
54     \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.begin(\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort});
55 
56     this->\hyperlink{classCoolTime_aae601f795452cfa48d9fb337aed483a8}{update}();
57 
58     
59     this->\hyperlink{classCoolTime_aae601f795452cfa48d9fb337aed483a8}{update}();
60     
61 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_ab1976cf718b950bc31e003c3323b8adb_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=296pt]{classCoolTime_ab1976cf718b950bc31e003c3323b8adb_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129}\label{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129}} 
\index{Cool\+Time@{Cool\+Time}!config@{config}}
\index{config@{config}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{config()}{config()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Cool\+Time\+::config (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129}{Cool\+Time\+::config()}\+: This method is provided to configure the \hyperlink{classCoolTime}{Cool\+Time} object through a configuration file.

\begin{DoxyReturn}{Returns}
true if successful,false otherwise 
\end{DoxyReturn}
\hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{Cool\+Time\+::save\+Time\+Sync()} This method is provided to save last syncronisation time to the S\+P\+I\+F\+FS

\hyperlink{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1}{Cool\+Time\+::print\+Conf()}\+: This method is provided to print the \hyperlink{classCoolTime}{Cool\+Time} configuration to the Serial Monitor

Cool\+Time\+::print\+Digits(digit)

utility method for digital clock display adds leading 0

\begin{DoxyReturn}{Returns}
formatted string of the input digit
\end{DoxyReturn}


Definition at line 445 of file Cool\+Time.\+cpp.



References format\+Digits(), local\+Port, print\+Conf(), save\+Time\+Sync(), time\+Server, and time\+Sync.



Referenced by Cool\+Board\+::begin(), and Cool\+Board\+::update().


\begin{DoxyCode}
446 \{
447 
448 \textcolor{preprocessor}{#if DEBUG == 1 }
449 
450     Serial.println(\textcolor{stringliteral}{"Enter CoolTime.config()"});
451     Serial.println();
452 
453 \textcolor{preprocessor}{#endif }
454 
455     File rtcConfig = SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"r"});
456 
457     \textcolor{keywordflow}{if} (!rtcConfig) 
458     \{
459     
460 \textcolor{preprocessor}{    #if DEBUG == 1 }
461 
462         Serial.println(\textcolor{stringliteral}{"failed to read /rtcConfig.json"});
463         Serial.println();
464     
465 \textcolor{preprocessor}{    #endif}
466 
467         \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
468     \}
469     \textcolor{keywordflow}{else}
470     \{
471         \textcolor{keywordtype}{size\_t} size = rtcConfig.size();
472         \textcolor{comment}{// Allocate a buffer to store contents of the file.}
473         std::unique\_ptr<char[]> buf(\textcolor{keyword}{new} \textcolor{keywordtype}{char}[size]);
474 
475         rtcConfig.readBytes(buf.get(), size);
476         DynamicJsonBuffer jsonBuffer;
477         JsonObject& json = jsonBuffer.parseObject(buf.get());
478         \textcolor{keywordflow}{if} (!json.success()) 
479         \{
480         
481 \textcolor{preprocessor}{        #if DEBUG == 1 }
482 
483             Serial.println(\textcolor{stringliteral}{"failed to parse json"});
484             Serial.println();
485         
486 \textcolor{preprocessor}{        #endif }
487 
488             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
489         \} 
490         \textcolor{keywordflow}{else}
491         \{  
492         
493 \textcolor{preprocessor}{        #if DEBUG == 1 }
494 
495             Serial.println(\textcolor{stringliteral}{"configuration json is :"});
496             json.printTo(Serial);
497             Serial.println();
498 
499 \textcolor{preprocessor}{        #endif}
500 
501             String ip;
502             
503             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeServer"}].success() )
504             \{           
505                  ip=json[\textcolor{stringliteral}{"timeServer"}].as<String>();
506                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}.fromString(ip);
507                 
508             \}
509             \textcolor{keywordflow}{else}
510             \{
511                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}=this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer};
512             \}
513             json[\textcolor{stringliteral}{"timeServer"}]=ip;
514             
515             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"localPort"}].success() )
516             \{                       
517                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=json[\textcolor{stringliteral}{"localPort"}];
518             \}
519             \textcolor{keywordflow}{else}
520             \{
521                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
522             \}
523             json[\textcolor{stringliteral}{"localPort"}]=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
524 
525 <<<<<<< HEAD
526             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeSync"}].success() )
527             \{                       
528 =======
529 
530             \textcolor{keywordflow}{if}( json[\textcolor{stringliteral}{"timeSync"}].success() )
531             \{
532 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
533                 this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync}=json[\textcolor{stringliteral}{"timeSync"}];
534             \}
535             \textcolor{keywordflow}{else}
536             \{
537                 this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync}=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
538             \}
539             json[\textcolor{stringliteral}{"timeSync"}]=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
540 
541 <<<<<<< HEAD
542 =======
543 
544 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
545             rtcConfig.close();
546             rtcConfig= SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"w"});
547             
548             \textcolor{keywordflow}{if}(!rtcConfig)
549             \{
550             
551 \textcolor{preprocessor}{            #if DEBUG == 1}
552 
553                 Serial.println(\textcolor{stringliteral}{"failed to write to /rtcConfig.json"});
554                 Serial.println();
555             
556 \textcolor{preprocessor}{            #endif}
557 
558                 \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
559             \}
560             
561             json.printTo(rtcConfig);
562             rtcConfig.close();
563 
564 \textcolor{preprocessor}{        #if DEBUG == 1 }
565 
566             Serial.println(\textcolor{stringliteral}{"configuration is :"});
567             json.printTo(Serial);
568             Serial.println();
569         
570 \textcolor{preprocessor}{        #endif}
571         
572             \textcolor{keywordflow}{return}(\textcolor{keyword}{true}); 
573         \}
574     \}   
575 
576 
577 
578 \}
579 
580 
587 \textcolor{keywordtype}{bool} \hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{CoolTime::saveTimeSync}()
588 \{
589     Serial.println(\textcolor{stringliteral}{"Enter CoolTime.saveTimeSync()"});
590     Serial.println();
591 
592     File rtcConfig = SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"r"});
593 
594     \textcolor{keywordflow}{if} (!rtcConfig) 
595     \{
596         Serial.println(\textcolor{stringliteral}{"failed to read /rtcConfig.json"});
597         Serial.println();
598 
599         \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
600     \}
601     \textcolor{keywordflow}{else}
602     \{
603         \textcolor{keywordtype}{size\_t} size = rtcConfig.size();
604         \textcolor{comment}{// Allocate a buffer to store contents of the file.}
605         std::unique\_ptr<char[]> buf(\textcolor{keyword}{new} \textcolor{keywordtype}{char}[size]);
606 
607         rtcConfig.readBytes(buf.get(), size);
608         DynamicJsonBuffer jsonBuffer;
609         JsonObject& json = jsonBuffer.parseObject(buf.get());
610         \textcolor{keywordflow}{if} (!json.success()) 
611         \{
612             Serial.println(\textcolor{stringliteral}{"failed to parse json"});
613             Serial.println();
614 
615             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
616         \} 
617         \textcolor{keywordflow}{else}
618         \{   
619             Serial.println(\textcolor{stringliteral}{"configuration json is :"});
620             json.printTo(Serial);
621             Serial.println();
622 
623             String ip;
624             
625             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeZone"}].success() )
626             \{
627                 this->timeZone=json[\textcolor{stringliteral}{"timeZone"}] ;
628             \}
629             \textcolor{keywordflow}{else}
630             \{
631                 this->timeZone=this->timeZone;          
632             \}
633             json[\textcolor{stringliteral}{"timeZone"}]=this->timeZone;
634             
635             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeServer"}].success() )
636             \{           
637                  ip=json[\textcolor{stringliteral}{"timeServer"}].as<String>();
638                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}.fromString(ip);
639                 
640             \}
641             \textcolor{keywordflow}{else}
642             \{
643                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}=this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer};
644             \}
645             json[\textcolor{stringliteral}{"timeServer"}]=ip;
646             
647             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"localPort"}].success() )
648             \{                       
649                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=json[\textcolor{stringliteral}{"localPort"}];
650             \}
651             \textcolor{keywordflow}{else}
652             \{
653                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
654             \}
655             json[\textcolor{stringliteral}{"localPort"}]=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
656 
657 
658             \textcolor{keywordflow}{if}( json[\textcolor{stringliteral}{"timeSync"}].success() )
659             \{
660                 json[\textcolor{stringliteral}{"timeSync"}]=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
661             \}
662             \textcolor{keywordflow}{else}
663             \{
664                 this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync}=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
665             \}
666             json[\textcolor{stringliteral}{"timeSync"}]=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
667 
668 
669             rtcConfig.close();
670             rtcConfig= SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"w"});
671             
672             \textcolor{keywordflow}{if}(!rtcConfig)
673             \{
674                 Serial.println(\textcolor{stringliteral}{"failed to write timeSync to /rtcConfig.json"});
675                 Serial.println();
676 
677                 \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
678             \}
679             
680             json.printTo(rtcConfig);
681             rtcConfig.close();
682 
683             Serial.println(\textcolor{stringliteral}{"configuration is :"});
684             json.printTo(Serial);
685             Serial.println();
686         
687             \textcolor{keywordflow}{return}(\textcolor{keyword}{true}); 
688         \}
689     \}   
690 
691 
692 
693 \}
694 
701 \textcolor{keywordtype}{void} \hyperlink{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1}{CoolTime::printConf}()
702 \{
703 
704 \textcolor{preprocessor}{#if DEBUG == 1}
705 
706     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.printConf()"});
707     Serial.println();
708 
709 \textcolor{preprocessor}{#endif }
710 
711 <<<<<<< HEAD
712     Serial.println(\textcolor{stringliteral}{"RTC Configuration"}) ;
713 =======
714     \textcolor{comment}{//Serial.print("timeZone : ");}
715     \textcolor{comment}{//Serial.println(timeZone);}
716 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
717 
718     Serial.print(\textcolor{stringliteral}{"timeServer : "});
719     Serial.println(\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer});
720     
721     Serial.print(\textcolor{stringliteral}{"localPort : :"});
722     Serial.println(\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort});
723 \}
724 
733 String \hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{CoolTime::formatDigits}(\textcolor{keywordtype}{int} digits)
734 \{
735 <<<<<<< HEAD
736 
737 \textcolor{preprocessor}{#if DEBUG == 1 }
738 
739     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.formatDigits()"});
740     Serial.println();
741 =======
742     \textcolor{comment}{//Serial.println("Entering CoolTime.formatDigits()");}
743     \textcolor{comment}{//Serial.println();}
744 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
745 
746 \textcolor{preprocessor}{#endif }
747 
748     \textcolor{keywordflow}{if}(digits < 10)
749     \{
750 <<<<<<< HEAD
751     
752 \textcolor{preprocessor}{    #if DEBUG == 1}
753 
754         Serial.println(\textcolor{stringliteral}{"output digit : "});
755         Serial.println( String(\textcolor{stringliteral}{"0"}) + String(digits) );
756 
757 \textcolor{preprocessor}{    #endif}
758 
759         \textcolor{keywordflow}{return}( String(\textcolor{stringliteral}{"0"}) + String(digits) );
760     \}
761     
762 \textcolor{preprocessor}{#if DEBUG == 1 }
763 
764     Serial.println(\textcolor{stringliteral}{"output digit : "});
765     Serial.println(digits);
766 
767 \textcolor{preprocessor}{#endif}
768 
769 =======
770         \textcolor{comment}{//Serial.println("output digit : ");}
771         \textcolor{comment}{//Serial.println( String("0") + String(digits) );}
772         \textcolor{keywordflow}{return}( String(\textcolor{stringliteral}{"0"}) + String(digits) );
773     \}
774     
775     \textcolor{comment}{//Serial.println("output digit : ");}
776     \textcolor{comment}{//Serial.println(digits);}
777 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
778     \textcolor{keywordflow}{return}( String(digits) );
779 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=337pt]{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a87c28260c1bc77091162cbcf1ee2e129_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a014656d0d3f74d6391364b92b13e0780}\label{classCoolTime_a014656d0d3f74d6391364b92b13e0780}} 
\index{Cool\+Time@{Cool\+Time}!config@{config}}
\index{config@{config}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{config()}{config()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Cool\+Time\+::config (\begin{DoxyParamCaption}\item[{I\+P\+Address}]{time\+Server,  }\item[{unsigned int}]{local\+Port }\end{DoxyParamCaption})}

Cool\+Time\+::config(\+Time server I\+P , udp Port)\+: This method is provided to do manual configuration. 

Definition at line 422 of file Cool\+Time.\+cpp.



References local\+Port, and time\+Server.


\begin{DoxyCode}
423 \{
424 
425 \textcolor{preprocessor}{#if DEBUG == 1 }
426 
427     Serial.println(\textcolor{stringliteral}{"Enter CoomTime.config() , no SPIFFS variant "});
428     Serial.println();
429 
430 \textcolor{preprocessor}{#endif }
431 
432     this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}=\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer};
433     this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
434     
435 \} 
\end{DoxyCode}
\mbox{\Hypertarget{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}\label{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}} 
\index{Cool\+Time@{Cool\+Time}!format\+Digits@{format\+Digits}}
\index{format\+Digits@{format\+Digits}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{format\+Digits()}{formatDigits()}}
{\footnotesize\ttfamily String Cool\+Time\+::format\+Digits (\begin{DoxyParamCaption}\item[{int}]{digits }\end{DoxyParamCaption})}



Referenced by config(), get\+E\+S\+Date(), get\+Time\+Date(), and set\+Date\+Time().

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_ac4f32ee513c1328d984306645e8785a4}\label{classCoolTime_ac4f32ee513c1328d984306645e8785a4}} 
\index{Cool\+Time@{Cool\+Time}!get\+E\+S\+Date@{get\+E\+S\+Date}}
\index{get\+E\+S\+Date@{get\+E\+S\+Date}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{get\+E\+S\+Date()}{getESDate()}}
{\footnotesize\ttfamily String Cool\+Time\+::get\+E\+S\+Date (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Cool\+Time\+::get\+E\+S\+D()\+: This method is provided to return an Elastic Search compatible date Format

\begin{DoxyReturn}{Returns}
date String in Elastic Search format 
\end{DoxyReturn}


Definition at line 202 of file Cool\+Time.\+cpp.



References format\+Digits(), and get\+Time\+Date().



Referenced by set\+Date\+Time(), and Cool\+Board\+::user\+Data().


\begin{DoxyCode}
203 \{
204 
205 \textcolor{preprocessor}{#if DEBUG == 1 }
206 
207     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.getESDate()"});
208     Serial.println();
209 
210 \textcolor{preprocessor}{#endif }
211 
212     tmElements\_t tm=this->\hyperlink{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c}{getTimeDate}();
213 
214     \textcolor{comment}{//"20yy-mm-ddT00:00:00Z"}
215     String elasticSearchString =String(tm.Year+1970)+\textcolor{stringliteral}{"-"}+this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}(tm.Month)+\textcolor{stringliteral}{"-"};
216 
217     elasticSearchString +=this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}(tm.Day)+\textcolor{stringliteral}{"T"}+this->
      \hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}(tm.Hour)+\textcolor{stringliteral}{":"};
218     
219     elasticSearchString +=this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}(tm.Minute)+\textcolor{stringliteral}{":"}+this->
      \hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}(tm.Second)+\textcolor{stringliteral}{"Z"};
220 
221 \textcolor{preprocessor}{#if DEBUG == 1 }
222 
223     Serial.print(\textcolor{stringliteral}{"elastic Search date : "});
224     Serial.println(elasticSearchString);
225     Serial.println();
226 
227 \textcolor{preprocessor}{#endif}
228 
229     \textcolor{keywordflow}{return} (elasticSearchString);
230 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_ac4f32ee513c1328d984306645e8785a4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_ac4f32ee513c1328d984306645e8785a4_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}\label{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}} 
\index{Cool\+Time@{Cool\+Time}!get\+Last\+Sync\+Time@{get\+Last\+Sync\+Time}}
\index{get\+Last\+Sync\+Time@{get\+Last\+Sync\+Time}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{get\+Last\+Sync\+Time()}{getLastSyncTime()}}
{\footnotesize\ttfamily unsigned long Cool\+Time\+::get\+Last\+Sync\+Time (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}{Cool\+Time\+::get\+Last\+Sync\+Time()}\+: This method is provided to get the last time we syncronised the time

\begin{DoxyReturn}{Returns}
unsigned long representation of last syncronisation time in seconds 
\end{DoxyReturn}


Definition at line 240 of file Cool\+Time.\+cpp.



References time\+Sync.



Referenced by is\+Time\+Sync().


\begin{DoxyCode}
241 \{
242 
243 \textcolor{preprocessor}{#if DEBUG == 1 }
244 
245     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.getLastSyncTime()"});
246     Serial.println();
247     
248     Serial.print(\textcolor{stringliteral}{"last sync time : "});
249     Serial.println(this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync});
250 
251 \textcolor{preprocessor}{#endif }
252 
253     \textcolor{keywordflow}{return}(this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync});
254 \}
\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a5d17f707a9d337720493b2bce9d41c21_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705}\label{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705}} 
\index{Cool\+Time@{Cool\+Time}!get\+Ntp\+Time@{get\+Ntp\+Time}}
\index{get\+Ntp\+Time@{get\+Ntp\+Time}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{get\+Ntp\+Time()}{getNtpTime()}}
{\footnotesize\ttfamily time\+\_\+t Cool\+Time\+::get\+Ntp\+Time (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Cool\+Time\+::get\+Ntop\+Time()\+: This method is provided to get the Time through an N\+TP request to a Time Server

\begin{DoxyReturn}{Returns}
a time\+\_\+t (unsigned long ) timestamp in seconds 
\end{DoxyReturn}


Definition at line 312 of file Cool\+Time.\+cpp.



References N\+T\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE, packet\+Buffer, send\+N\+T\+Ppacket(), time\+Server, and Udp.



Referenced by update().


\begin{DoxyCode}
313 \{
314 
315 \textcolor{preprocessor}{#if DEBUG == 1 }
316 
317     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.getNtpTime()"});
318     Serial.println();
319 
320 \textcolor{preprocessor}{#endif }
321 
322     \textcolor{keywordflow}{while} (\hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.parsePacket() > 0) ; \textcolor{comment}{// discard any previously received packets}
323 
324 \textcolor{preprocessor}{#if DEBUG == 1 }
325     
326     Serial.println(\textcolor{stringliteral}{"Transmit NTP Request"});
327 
328 \textcolor{preprocessor}{#endif }
329 
330     \hyperlink{classCoolTime_a236a38d120dc53bc67456d763838c5a1}{sendNTPpacket}(\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer});
331 
332     uint32\_t beginWait = millis();
333 
334     \textcolor{keywordflow}{while} (millis() - beginWait < 1500) 
335     \{
336         \textcolor{keywordtype}{int} size = \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.parsePacket();
337         \textcolor{keywordflow}{if} (size >= \hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{NTP\_PACKET\_SIZE}) 
338         \{
339         
340 \textcolor{preprocessor}{        #if DEBUG == 1}
341 
342             Serial.println(\textcolor{stringliteral}{"Receive NTP Response"});
343         
344 \textcolor{preprocessor}{        #endif}
345 
346             \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.read(\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}, \hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{NTP\_PACKET\_SIZE});  \textcolor{comment}{// read packet into the
       buffer}
347             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} secsSince1900;
348             \textcolor{comment}{// convert four bytes starting at location 40 to a long integer}
349             secsSince1900 =  (\textcolor{keywordtype}{unsigned} long)\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[40] << 24;
350             secsSince1900 |= (\textcolor{keywordtype}{unsigned} long)\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[41] << 16;
351             secsSince1900 |= (\textcolor{keywordtype}{unsigned} long)\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[42] << 8;
352             secsSince1900 |= (\textcolor{keywordtype}{unsigned} long)\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[43];
353         
354 \textcolor{preprocessor}{        #if DEBUG == 1 }
355     
356             Serial.print(\textcolor{stringliteral}{"received unix time : "});
357             Serial.println(secsSince1900 - 2208988800UL);
358             Serial.println();
359 <<<<<<< HEAD
360 \textcolor{preprocessor}{        #endif }
361 =======
362 
363             \textcolor{comment}{//Serial.print("received unix time +");}
364             \textcolor{comment}{//Serial.print(this->timeZone);}
365             \textcolor{comment}{//Serial.print(" : ");}
366             \textcolor{comment}{//Serial.println( secsSince1900 - 2208988800UL + this->timeZone * SECS\_PER\_HOUR );}
367             \textcolor{comment}{//Serial.println();}
368 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
369             
370             \textcolor{keywordflow}{return} secsSince1900 - 2208988800UL ;
371         \}
372     \}
373     
374 \textcolor{preprocessor}{#if DEBUG == 1}
375 
376     Serial.println(\textcolor{stringliteral}{"No NTP Response :-("});
377 
378 \textcolor{preprocessor}{#endif }
379 
380     \textcolor{keywordflow}{return} 0; \textcolor{comment}{// return 0 if unable to get the time}
381 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c}\label{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c}} 
\index{Cool\+Time@{Cool\+Time}!get\+Time\+Date@{get\+Time\+Date}}
\index{get\+Time\+Date@{get\+Time\+Date}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{get\+Time\+Date()}{getTimeDate()}}
{\footnotesize\ttfamily tm\+Elements\+\_\+t Cool\+Time\+::get\+Time\+Date (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c}{Cool\+Time\+::get\+Time\+Date()}\+: This method is provided to get the R\+TC Time

\begin{DoxyReturn}{Returns}
a tm\+Elements\+\_\+t structre that has the time in it 
\end{DoxyReturn}


Definition at line 159 of file Cool\+Time.\+cpp.



References format\+Digits(), and rtc.



Referenced by get\+E\+S\+Date().


\begin{DoxyCode}
160 \{
161 
162 \textcolor{preprocessor}{#if DEBUG == 1 }
163     
164     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.getTimeDate()"});
165     Serial.println();
166 
167 \textcolor{preprocessor}{#endif}
168 
169     tmElements\_t tm;
170     time\_t timeDate = this->\hyperlink{classCoolTime_abd38f2384ff90692b1568d9db869412e}{rtc}.get(CLOCK\_ADDRESS);
171     breakTime(timeDate,tm);
172 
173 \textcolor{preprocessor}{#if DEBUG == 1}
174     
175     Serial.print(\textcolor{stringliteral}{"time is : "});
176     Serial.print(tm.Year+ 1970 );
177     Serial.print(\textcolor{stringliteral}{"-"});
178     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Month ) );
179     Serial.print(\textcolor{stringliteral}{"-"});
180     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Day ) );
181     Serial.print(\textcolor{stringliteral}{"T"});
182     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Hour ) );
183     Serial.print(\textcolor{stringliteral}{":"});
184     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Minute ) );
185     Serial.print( \textcolor{stringliteral}{":"} );
186     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Second ) );
187     Serial.print(\textcolor{stringliteral}{"Z"});
188 
189 \textcolor{preprocessor}{#endif}
190     
191     \textcolor{keywordflow}{return}(tm);
192 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a7a7501c5ca77dd1248bea704c44f986c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_a5ae038a4498602b189f76a10bf02adf8}\label{classCoolTime_a5ae038a4498602b189f76a10bf02adf8}} 
\index{Cool\+Time@{Cool\+Time}!is\+Time\+Sync@{is\+Time\+Sync}}
\index{is\+Time\+Sync@{is\+Time\+Sync}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{is\+Time\+Sync()}{isTimeSync()}}
{\footnotesize\ttfamily bool Cool\+Time\+::is\+Time\+Sync (\begin{DoxyParamCaption}\item[{unsigned long}]{seconds = {\ttfamily 604800} }\end{DoxyParamCaption})}

Cool\+Time\+::is\+Time\+Sync( time in seconds)\+: This method is provided to test if the time is syncronised or not. By default we test once per week.

\begin{DoxyReturn}{Returns}
true if time is syncronised,false otherwise 
\end{DoxyReturn}


Definition at line 266 of file Cool\+Time.\+cpp.



References get\+Last\+Sync\+Time().



Referenced by update().


\begin{DoxyCode}
267 \{
268 
269 \textcolor{preprocessor}{#if DEBUG == 1}
270 
271     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.isTimeSync() "});
272     Serial.println();
273 
274 <<<<<<< HEAD
275 \textcolor{preprocessor}{#endif }
276 
277     \textcolor{comment}{//default is once per week we try to get a time update}
278     \textcolor{keywordflow}{if}( ( RTC.get( CLOCK\_ADDRESS ) ) - ( this->\hyperlink{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}{getLastSyncTime}() ) > ( seconds ) ) 
279 =======
280 \textcolor{comment}{//default is once per week we try to get a time update}
281     \textcolor{keywordflow}{if}( ( RTC.get(CLOCK\_ADDRESS) - this->\hyperlink{classCoolTime_a5d17f707a9d337720493b2bce9d41c21}{getLastSyncTime}() ) > ( seconds ) ) 
282 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
283     \{
284 
285 \textcolor{preprocessor}{    #if DEBUG == 1 }
286 
287         Serial.println(\textcolor{stringliteral}{"time is not syncronised "});
288     
289 \textcolor{preprocessor}{    #endif}
290 
291         \textcolor{keywordflow}{return}(\textcolor{keyword}{false});  
292     \}
293     
294 \textcolor{preprocessor}{#if DEBUG == 1 }
295 
296     Serial.println(\textcolor{stringliteral}{"time is syncronised "});
297 
298 \textcolor{preprocessor}{#endif }
299 
300     \textcolor{keywordflow}{return}(\textcolor{keyword}{true});
301 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a5ae038a4498602b189f76a10bf02adf8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a5ae038a4498602b189f76a10bf02adf8_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1}\label{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1}} 
\index{Cool\+Time@{Cool\+Time}!print\+Conf@{print\+Conf}}
\index{print\+Conf@{print\+Conf}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{print\+Conf()}{printConf()}}
{\footnotesize\ttfamily void Cool\+Time\+::print\+Conf (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Referenced by Cool\+Board\+::begin(), and config().

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_af355e7f9b3898211cd2ff25eab5933b1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}\label{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}} 
\index{Cool\+Time@{Cool\+Time}!save\+Time\+Sync@{save\+Time\+Sync}}
\index{save\+Time\+Sync@{save\+Time\+Sync}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{save\+Time\+Sync()}{saveTimeSync()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Cool\+Time\+::save\+Time\+Sync (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{Cool\+Time\+::save\+Time\+Sync()} This method is provided to save the last sync time in the S\+P\+I\+F\+FS.

\begin{DoxyReturn}{Returns}
true if successful,false otherwise 
\end{DoxyReturn}


Definition at line 790 of file Cool\+Time.\+cpp.



References local\+Port, time\+Server, and time\+Sync.



Referenced by config(), and update().


\begin{DoxyCode}
791 \{
792 
793 \textcolor{preprocessor}{#if DEBUG == 1}
794 
795     Serial.println(\textcolor{stringliteral}{"Enter CoolTime.saveTimeSync()"});
796     Serial.println();
797 
798 \textcolor{preprocessor}{#endif }
799 
800     File rtcConfig = SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"r"});
801 
802     \textcolor{keywordflow}{if} (!rtcConfig) 
803     \{
804     
805 \textcolor{preprocessor}{    #if DEBUG == 1}
806 
807         Serial.println(\textcolor{stringliteral}{"failed to read /rtcConfig.json"});
808         Serial.println();
809     
810 \textcolor{preprocessor}{    #endif }
811 
812         \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
813     \}
814     \textcolor{keywordflow}{else}
815     \{
816         \textcolor{keywordtype}{size\_t} size = rtcConfig.size();
817         \textcolor{comment}{// Allocate a buffer to store contents of the file.}
818         std::unique\_ptr<char[]> buf(\textcolor{keyword}{new} \textcolor{keywordtype}{char}[size]);
819 
820         rtcConfig.readBytes(buf.get(), size);
821         DynamicJsonBuffer jsonBuffer;
822         JsonObject& json = jsonBuffer.parseObject(buf.get());
823         \textcolor{keywordflow}{if} (!json.success()) 
824         \{
825         
826 \textcolor{preprocessor}{        #if DEBUG == 1}
827 
828             Serial.println(\textcolor{stringliteral}{"failed to parse json"});
829             Serial.println();
830         
831 \textcolor{preprocessor}{        #endif }
832             
833             \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
834         \} 
835         \textcolor{keywordflow}{else}
836         \{
837         
838 \textcolor{preprocessor}{        #if DEBUG == 1 }
839     
840             Serial.println(\textcolor{stringliteral}{"configuration json is :"});
841             json.printTo(Serial);
842             Serial.println();
843         
844 \textcolor{preprocessor}{        #endif }
845 
846             String ip;
847             
848             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeServer"}].success() )
849             \{           
850                  ip=json[\textcolor{stringliteral}{"timeServer"}].as<String>();
851                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}.fromString(ip);
852                 
853             \}
854             \textcolor{keywordflow}{else}
855             \{
856                 this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer}=this->\hyperlink{classCoolTime_ad2b9858f399108cb440dd1e908916f04}{timeServer};
857             \}
858             json[\textcolor{stringliteral}{"timeServer"}]=ip;
859             
860             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"localPort"}].success() )
861             \{                       
862                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=json[\textcolor{stringliteral}{"localPort"}];
863             \}
864             \textcolor{keywordflow}{else}
865             \{
866                 this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort}=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
867             \}
868             json[\textcolor{stringliteral}{"localPort"}]=this->\hyperlink{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}{localPort};
869 
870             \textcolor{keywordflow}{if}(json[\textcolor{stringliteral}{"timeSync"}].success() )
871             \{                       
872                 json[\textcolor{stringliteral}{"timeSync"}]=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
873             \}
874             \textcolor{keywordflow}{else}
875             \{
876                 this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync}=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
877             \}
878             json[\textcolor{stringliteral}{"timeSync"}]=this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync};
879 
880             rtcConfig.close();
881             rtcConfig= SPIFFS.open(\textcolor{stringliteral}{"/rtcConfig.json"}, \textcolor{stringliteral}{"w"});
882             
883             \textcolor{keywordflow}{if}(!rtcConfig)
884             \{
885             
886 \textcolor{preprocessor}{            #if DEBUG == 1 }
887 
888                 Serial.println(\textcolor{stringliteral}{"failed to write to /rtcConfig.json"});
889                 Serial.println();
890             
891 \textcolor{preprocessor}{            #endif }
892 
893                 \textcolor{keywordflow}{return}(\textcolor{keyword}{false});
894             \}
895             
896             json.printTo(rtcConfig);
897             rtcConfig.close();
898 
899 \textcolor{preprocessor}{        #if DEBUG == 1 }
900 
901             Serial.println(\textcolor{stringliteral}{"configuration is :"});
902             json.printTo(Serial);
903             Serial.println();
904         
905 \textcolor{preprocessor}{        #endif}
906         
907             \textcolor{keywordflow}{return}(\textcolor{keyword}{true}); 
908         \}
909     \}   
910 
911 \}
\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_ae9658c9b377510d469e3b88edf33ee85_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}\label{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}} 
\index{Cool\+Time@{Cool\+Time}!save\+Time\+Sync@{save\+Time\+Sync}}
\index{save\+Time\+Sync@{save\+Time\+Sync}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{save\+Time\+Sync()}{saveTimeSync()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool Cool\+Time\+::save\+Time\+Sync (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{classCoolTime_a236a38d120dc53bc67456d763838c5a1}\label{classCoolTime_a236a38d120dc53bc67456d763838c5a1}} 
\index{Cool\+Time@{Cool\+Time}!send\+N\+T\+Ppacket@{send\+N\+T\+Ppacket}}
\index{send\+N\+T\+Ppacket@{send\+N\+T\+Ppacket}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{send\+N\+T\+Ppacket()}{sendNTPpacket()}}
{\footnotesize\ttfamily void Cool\+Time\+::send\+N\+T\+Ppacket (\begin{DoxyParamCaption}\item[{I\+P\+Address \&}]{address }\end{DoxyParamCaption})}

Cool\+Time\+::send\+N\+T\+Ppacket( Time Server I\+P address)\+: This method is provided to send an N\+TP request to the time server at the given address 

Definition at line 388 of file Cool\+Time.\+cpp.



References N\+T\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE, packet\+Buffer, and Udp.



Referenced by get\+Ntp\+Time().


\begin{DoxyCode}
389 \{
390 
391 \textcolor{preprocessor}{#if DEBUG == 1 }
392 
393     Serial.println(\textcolor{stringliteral}{"Enter CoolTime.sendNTPpacket()"});
394     Serial.println();
395 
396 \textcolor{preprocessor}{#endif}
397 
398     memset(\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}, 0, \hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{NTP\_PACKET\_SIZE});
399     \textcolor{comment}{// Initialize values needed to form NTP request}
400     \textcolor{comment}{// (see URL above for details on the packets)}
401     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[0] = 0b11100011;   \textcolor{comment}{// LI, Version, Mode}
402     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[1] = 0;     \textcolor{comment}{// Stratum, or type of clock}
403     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[2] = 6;     \textcolor{comment}{// Polling Interval}
404     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[3] = 0xEC;  \textcolor{comment}{// Peer Clock Precision}
405     \textcolor{comment}{// 8 bytes of zero for Root Delay & Root Dispersion}
406     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[12]  = 49;
407     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[13]  = 0x4E;
408     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[14]  = 49;
409     \hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}[15]  = 52;
410     \textcolor{comment}{// all NTP fields have been given values, now}
411     \textcolor{comment}{// you can send a packet requesting a timestamp:                 }
412     \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.beginPacket(address, 123); \textcolor{comment}{//NTP requests are to port 123}
413     \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.write(\hyperlink{classCoolTime_a27e6abc82a5c2f72161956967005bec7}{packetBuffer}, \hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{NTP\_PACKET\_SIZE});
414     \hyperlink{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}{Udp}.endPacket(); 
415 \}
\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_a236a38d120dc53bc67456d763838c5a1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_ab81ea7fdaace111aa01cc1ec84c6d297}\label{classCoolTime_ab81ea7fdaace111aa01cc1ec84c6d297}} 
\index{Cool\+Time@{Cool\+Time}!set\+Date\+Time@{set\+Date\+Time}}
\index{set\+Date\+Time@{set\+Date\+Time}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{set\+Date\+Time()}{setDateTime()}}
{\footnotesize\ttfamily void Cool\+Time\+::set\+Date\+Time (\begin{DoxyParamCaption}\item[{int}]{year,  }\item[{int}]{month,  }\item[{int}]{day,  }\item[{int}]{hour,  }\item[{int}]{minutes,  }\item[{int}]{seconds }\end{DoxyParamCaption})}

Cool\+Time\+::set\+Date\+Time(year,month,dat,hour,minutes,seconds)\+: This method is provided to manually set the R\+Tc Time 

Definition at line 105 of file Cool\+Time.\+cpp.



References format\+Digits(), get\+E\+S\+Date(), and rtc.


\begin{DoxyCode}
106 \{ 
107 
108 \textcolor{preprocessor}{#if DEBUG == 1}
109 
110     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.setDateTime"});
111     Serial.println();
112 
113 \textcolor{preprocessor}{#endif}
114 
115     tmElements\_t tm;
116     tm.Second=seconds; 
117     tm.Minute=minutes; 
118     tm.Hour=hour; 
119     tm.Day=day;
120     tm.Month=month; 
121     tm.Year=year;
122     
123     this->\hyperlink{classCoolTime_abd38f2384ff90692b1568d9db869412e}{rtc}.set(makeTime(tm),CLOCK\_ADDRESS);   
124 
125 \textcolor{preprocessor}{#if DEBUG == 1}
126 
127     Serial.print(\textcolor{stringliteral}{"setting time to : "});\textcolor{comment}{//"20yy-mm-ddT00:00:00Z}
128 
129     Serial.print(tm.Year);
130     Serial.print(\textcolor{stringliteral}{"-"});
131     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Month ) );
132     Serial.print(\textcolor{stringliteral}{"-"});
133     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Day ) );
134     Serial.print(\textcolor{stringliteral}{"T"});
135     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Hour ) );
136     Serial.print(\textcolor{stringliteral}{":"});
137     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Minute ) );
138     Serial.print( \textcolor{stringliteral}{":"} );
139     Serial.print( this->\hyperlink{classCoolTime_acd537cd4210d7bde4e1f5c47d2ac0456}{formatDigits}( tm.Second ) );
140     Serial.print(\textcolor{stringliteral}{"Z"});
141 
142     Serial.println();
143     
144     Serial.print(\textcolor{stringliteral}{"time set to : "});
145     Serial.println(this->\hyperlink{classCoolTime_ac4f32ee513c1328d984306645e8785a4}{getESDate}());
146     Serial.println();
147 
148 \textcolor{preprocessor}{#endif}
149 
150 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_ab81ea7fdaace111aa01cc1ec84c6d297_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classCoolTime_aae601f795452cfa48d9fb337aed483a8}\label{classCoolTime_aae601f795452cfa48d9fb337aed483a8}} 
\index{Cool\+Time@{Cool\+Time}!update@{update}}
\index{update@{update}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{update()}{update()}}
{\footnotesize\ttfamily void Cool\+Time\+::update (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\hyperlink{classCoolTime_aae601f795452cfa48d9fb337aed483a8}{Cool\+Time\+::update()}\+: This method is provided to correct the rtc Time when it drifts,once every week. 

Definition at line 68 of file Cool\+Time.\+cpp.



References get\+Ntp\+Time(), is\+Time\+Sync(), rtc, save\+Time\+Sync(), time\+Sync, and tm\+Set.



Referenced by begin(), and Cool\+Board\+::on\+Line\+Mode().


\begin{DoxyCode}
69 \{
70 
71 \textcolor{preprocessor}{#if DEBUG == 1}
72 
73     Serial.println(\textcolor{stringliteral}{"Entering CoolTime.update()"});
74     Serial.println();
75 
76 \textcolor{preprocessor}{#endif }
77 
78     \textcolor{keywordflow}{if}( !( this->\hyperlink{classCoolTime_a5ae038a4498602b189f76a10bf02adf8}{isTimeSync}() ) )
79     \{
80     
81 \textcolor{preprocessor}{    #if DEBUG == 1}
82 
83         Serial.println(\textcolor{stringliteral}{"waiting for sync"});
84         Serial.println();
85 
86 \textcolor{preprocessor}{    #endif }
87 
88         this->\hyperlink{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}{timeSync}=this->\hyperlink{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705}{getNtpTime}();
89         breakTime(this->\hyperlink{classCoolTime_a41fbbbfd651c2079f54d4b2911e4c705}{getNtpTime}(), this->\hyperlink{classCoolTime_ad33c2713c903ff064ad09c46406ae088}{tmSet});
90         this->\hyperlink{classCoolTime_abd38f2384ff90692b1568d9db869412e}{rtc}.set(makeTime(this->\hyperlink{classCoolTime_ad33c2713c903ff064ad09c46406ae088}{tmSet}), CLOCK\_ADDRESS); \textcolor{comment}{// set the clock}
91 <<<<<<< HEAD
92 =======
93 
94 >>>>>>> 022ecfccbd47fa628feca52fc7c1ee420c585e2b
95         this->\hyperlink{classCoolTime_ae9658c9b377510d469e3b88edf33ee85}{saveTimeSync}();
96     \}
97     
98 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_aae601f795452cfa48d9fb337aed483a8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classCoolTime_aae601f795452cfa48d9fb337aed483a8_icgraph}
\end{center}
\end{figure}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}\label{classCoolTime_a2f777da44d7ba678be8185299e9b49d1}} 
\index{Cool\+Time@{Cool\+Time}!local\+Port@{local\+Port}}
\index{local\+Port@{local\+Port}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{local\+Port}{localPort}}
{\footnotesize\ttfamily unsigned int Cool\+Time\+::local\+Port =0\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 73 of file Cool\+Time.\+h.



Referenced by begin(), config(), and save\+Time\+Sync().

\mbox{\Hypertarget{classCoolTime_a27e6abc82a5c2f72161956967005bec7}\label{classCoolTime_a27e6abc82a5c2f72161956967005bec7}} 
\index{Cool\+Time@{Cool\+Time}!packet\+Buffer@{packet\+Buffer}}
\index{packet\+Buffer@{packet\+Buffer}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{packet\+Buffer}{packetBuffer}}
{\footnotesize\ttfamily byte Cool\+Time\+::packet\+Buffer\mbox{[}\hyperlink{CoolTime_8h_a56a6ea64006651b4f42adf713e244f06}{N\+T\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE}\mbox{]}\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 75 of file Cool\+Time.\+h.



Referenced by get\+Ntp\+Time(), and send\+N\+T\+Ppacket().

\mbox{\Hypertarget{classCoolTime_abd38f2384ff90692b1568d9db869412e}\label{classCoolTime_abd38f2384ff90692b1568d9db869412e}} 
\index{Cool\+Time@{Cool\+Time}!rtc@{rtc}}
\index{rtc@{rtc}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{rtc}{rtc}}
{\footnotesize\ttfamily D\+S1337\+R\+TC Cool\+Time\+::rtc\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 79 of file Cool\+Time.\+h.



Referenced by get\+Time\+Date(), set\+Date\+Time(), and update().

\mbox{\Hypertarget{classCoolTime_ad2b9858f399108cb440dd1e908916f04}\label{classCoolTime_ad2b9858f399108cb440dd1e908916f04}} 
\index{Cool\+Time@{Cool\+Time}!time\+Server@{time\+Server}}
\index{time\+Server@{time\+Server}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{time\+Server}{timeServer}}
{\footnotesize\ttfamily I\+P\+Address Cool\+Time\+::time\+Server\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 69 of file Cool\+Time.\+h.



Referenced by config(), get\+Ntp\+Time(), and save\+Time\+Sync().

\mbox{\Hypertarget{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}\label{classCoolTime_a9d032e76c3470a15b3bbbc52af6463f7}} 
\index{Cool\+Time@{Cool\+Time}!time\+Sync@{time\+Sync}}
\index{time\+Sync@{time\+Sync}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{time\+Sync}{timeSync}}
{\footnotesize\ttfamily unsigned long Cool\+Time\+::time\+Sync =0\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 67 of file Cool\+Time.\+h.



Referenced by config(), get\+Last\+Sync\+Time(), save\+Time\+Sync(), and update().

\mbox{\Hypertarget{classCoolTime_ad33c2713c903ff064ad09c46406ae088}\label{classCoolTime_ad33c2713c903ff064ad09c46406ae088}} 
\index{Cool\+Time@{Cool\+Time}!tm\+Set@{tm\+Set}}
\index{tm\+Set@{tm\+Set}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{tm\+Set}{tmSet}}
{\footnotesize\ttfamily tm\+Elements\+\_\+t Cool\+Time\+::tm\+Set\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 77 of file Cool\+Time.\+h.



Referenced by update().

\mbox{\Hypertarget{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}\label{classCoolTime_a4e23216a8121ca79d0fb019f30884b92}} 
\index{Cool\+Time@{Cool\+Time}!Udp@{Udp}}
\index{Udp@{Udp}!Cool\+Time@{Cool\+Time}}
\subsubsection{\texorpdfstring{Udp}{Udp}}
{\footnotesize\ttfamily Wi\+Fi\+U\+DP Cool\+Time\+::\+Udp\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 71 of file Cool\+Time.\+h.



Referenced by begin(), get\+Ntp\+Time(), and send\+N\+T\+Ppacket().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/ashiroji/\+Arduino/libraries/\+Cool\+Board/\hyperlink{CoolTime_8h}{Cool\+Time.\+h}\item 
/home/ashiroji/\+Arduino/libraries/\+Cool\+Board/\hyperlink{CoolTime_8cpp}{Cool\+Time.\+cpp}\end{DoxyCompactItemize}
